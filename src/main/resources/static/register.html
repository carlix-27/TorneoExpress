<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Torneos Express - Registro</title>
    <link rel="stylesheet" href="styles/styleRegister.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
<div class="register-box">
    <a href="javascript:history.back()" class="back-button"><i class="fas fa-arrow-left"></i> Back</a>
    <h2>Register new Account</h2>

    <form id="registration-form" action="api/auth/submit_registration" method="post">
        <div class="textbox">
            <i class="fas fa-user"></i>
            <input type="text" id="name" placeholder="Name" required>
        </div>
        <div class="textbox">
            <i class="fas fa-map-marker-alt"></i>
            <input type="text" id="location" placeholder="Location" required>
        </div>
        <div class="textbox">
            <i class="fas fa-envelope"></i>
            <input type="email" id="email" placeholder="Email" required>
        </div>
        <div class="textbox">
            <i class="fas fa-lock"></i>
            <input type="password" id="password" placeholder="Password" required>
        </div>
        <div id="error-message" style="color: red; margin-bottom: 10px; display: none;"></div> <!-- Error message div -->
        <input type="button" value="Register" name="register_button" onclick="register()">
    </form>

    <div class="login-link">
        <p>Already have an account? <a href="login.html">Login here</a></p>
    </div>

    <script>
        function register() {
            const name = document.getElementById('name').value;
            const location = document.getElementById('location').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            const registerRequest = {
                name: name,
                location: location,
                email: email,
                password: password
            };

            const xhr = new XMLHttpRequest();
            xhr.open('POST', 'api/auth/submit_registration', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.onload = function() {
                if (xhr.status === 200) {
                    const response = JSON.parse(xhr.responseText);
                    console.log(response);
                    localStorage.setItem("token", response.token);
                    window.location.replace("register_success.html");
                } else {
                    const errorMessage = document.getElementById('error-message');
                    errorMessage.textContent = "Email already in use"; // Set your error message here
                    errorMessage.style.display = "block"; // Display the error message div
                    console.error(xhr.responseText);
                }
            };
            xhr.send(JSON.stringify(registerRequest));
        }
    </script>
</div>
</body>
</html>
