<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Torneos Express - Login</title>
	<link rel="stylesheet" href="styles/styleLogin.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
<div class="login-box">
	<a href="javascript:history.back()" class="back-button"><i class="fas fa-arrow-left"></i> Back</a>
	<h2>Login</h2>

	<!-- Check for success message parameter -->
	<div id="success-message" style="color: green; margin-bottom: 10px; display: none;">Registration successful. You can now login.</div>

	<!-- Error message div -->
	<div id="error-message" style="color: red; margin-bottom: 10px; display: none;">Invalid email or password. Please try again.</div>

	<form id="login-form" action="/api/auth/login" method="post">
		<div class="textbox">
			<i class="fas fa-user"></i>
			<input type="text" id="email" placeholder="Email" required>
		</div>
		<div class="textbox">
			<i class="fas fa-lock"></i>
			<input type="password" id="password" placeholder="Password" required>
		</div>
		<input type="button" value="Login" name="login_button" onclick="login()">
	</form>

	<div class="register-link">
		<p>Don't have an account? <a href="register.html">Register here</a></p>
	</div>

	<script>
		function login() {
			const email = document.getElementById('email').value;
			const password = document.getElementById('password').value;
			const loginRequest = {
				email: email,
				password: password
			};

			const xhr = new XMLHttpRequest();
			xhr.open('POST', '/api/auth/login', true);
			xhr.setRequestHeader('Content-Type', 'application/json');
			xhr.onload = function() {
				if (xhr.status === 200) {
					const response = JSON.parse(xhr.responseText);
					console.log(response);
					localStorage.setItem("token", response.token);
					window.location.replace("home.html");
				} else {
					console.error(xhr.responseText);
					const errorMessage = document.getElementById('error-message');
					errorMessage.style.display = 'block'; // Display the error message
				}
			};
			xhr.send(JSON.stringify(loginRequest));
		}

		// Check for success message parameter in URL
		const urlParams = new URLSearchParams(window.location.search);
		if (urlParams.has('success')) {
			const successMessage = document.getElementById('success-message');
			successMessage.style.display = 'block'; // Display the success message
		}
	</script>
</div>
</body>
</html>
